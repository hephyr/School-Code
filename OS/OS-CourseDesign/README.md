# 模拟UNIX/Linux 文件系统

## 问题描述
在任一OS下，建立一个大文件，把它假象成一张盘，在其中实现一个简单的模拟UNIX文件系统 。

## 基本要求
1．在现有机器硬盘上开辟20M的硬盘空间，作为设定的硬盘空间。  
2．编写一管理程序对此空间进行管理，以模拟UNIX文件系统，具体要求如下：

- 要求盘块大小1k（即1024 byte） 

- i结点文件类型
> 普通文件、目录文件（共1byte）  
  物理地址（索引表）：共有13个表项，每表项2byte  
  文件长度(4byte）  
  联结计数(1byte）

- 0号块 超级块 栈长度50 byte  
  空闲盘块的管理：成组链接 (UNIX)

- 每建一个目录，分配4个物理块
  文件名   14byte

- 目录项信息
  i结点号  2byte
  文件名 14byte

- 文件系统结构：
> 0#号为超级块  
  1#-20#号为i节点
  21#－30#号为根目录区  

- 功能：
> 1、初始化  
  2、建立文件（需给出文件名，文件长度）  
  3、建立子目录  
  4、打开文件（显示文件所占的盘块）  
  5、删除文件  
  6、删除目录  
  7、显示目录（即显示目录下的信息，包括文件、子目录等）  
  8、显示整个系统信息  

## 题目分析：
### Unix文件系统结构：
> ~~0#       引导区： 存放操作系统引导和启动代码~~
 ~~1#       超级块：存放文件系统管理资源的描述信息。比如磁盘总数、空闲块数、块的大小等。其中有50byte的空闲盘块栈存放将要分配的空闲盘块。~~
 ~~2~21#    目录区： 存放根目录下文件和目录文件信息。目录项信息包括：文件名14byte，i结点号2byte。
 22#~31#  索引区： 也叫i结点区，存放每个文件的描述信息，包括文件类型1 byte，物理地址（共13个表项，每个表项2 byte），文件长度4 byte，联结计数1 byte
 32#~…   数据区： 普通文件数据及目录文件数据~~
 
 
> 0# 超级块  
[1,20] 目录区  
[21,30] 结点区：32B  
[31~] 数据区  

20M的硬盘空间，盘块大小为1K（即1024 byte），共计20480个盘块；  
目录区占10个盘块，一个目录项为16 byte，所以最多有640个目录项；  
引导区占20个盘块，一个索引结点为32 byte，所以最多有640个索引结点  

### 空闲盘块管理：
成组链接是将所有空闲盘块按50个块为一组，每组所有的盘块号记入其前一组的第一个盘块的s.free(0)~s.free(49)中。将第一组的盘块总数和所有盘块号记入超级块中的空闲盘块栈中。  
最末一组只有49个空闲盘块，其盘块号分别计入s.free(1)~s.free(49)中，s.free(0)中存放0，表示空闲盘块链结束。

### 二级索引的实现：
i索引结点的物理地址（索引表）：共有13个表项，每个表项2byte，其中前10项分别存放文件的实际存储盘块的首地址。若文件大小不超过10240 byte，则一级索引就够用了。但是如果文件很大则需要二级或多级索引，i索引结点的物理地址的第11项会指向一个二级索引结点项，若一个地址占2 byte，则此二级索引结点中将存放着512个盘块的地址，文件最大可以达到（512+10）*1024 byte


有关unix文件系统的相关理论可以参考http://www.docin.com/p-516002499.html的内容。
